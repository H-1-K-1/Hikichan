<p>
    Any changes you make here will simply be appended to <code>{{ file }}</code>. If you wish to make the most of Tinyboard's customizability, you can instead edit the file directly. This page is intended for making quick changes and for those who don't have a basic understanding of PHP code.
</p>
{% if not board %}
    <div style="margin-bottom:10px;">
        <label for="boardInput">Select a board to edit its configuration:</label>
        <input type="text" id="boardInput" placeholder="Enter board URI or title" style="width:200px;">
        <ul id="boardSuggestions" style="list-style:none;padding:0;margin:0;border:1px solid #ccc;max-height:120px;overflow:auto;display:none;"></ul>
    </div>
{% endif %}
<form method="post" action="">
    <input type="hidden" name="token" value="{{ token }}">
    <table class="mod config-editor">
        <tr>
            <th class="minimal">{% trans 'Name' %}</th>
            <th>{% trans 'Value' %}</th>
            <th class="minimal">{% trans 'Type' %}</th>
            <th>{% trans 'Description' %}</th>
        </tr>
        {% for var in conf %}
            {% if var.type != 'array' %}
                {% if var.name|length == 1 %}
                    {% set name = 'cf_' ~ var.name %}
                {% else %}
                    {% set name = 'cf_' ~ var.name|join('/') %}
                {% endif %}
                
                <tr>
                    <th class="minimal">
                        {% if var.name|length == 1 %}
                            {{ var.name }}
                        {% else %}
                            {{ var.name|join(' &rarr; ') }}
                        {% endif %}
                    </th>
                    
                    <td>
                        {% if var.type == 'string' %}
                            <input name="{{ name }}" type="text" value="{{ var.value|e }}">
                        {% elseif var.permissions %}
                            <select name="{{ name }}">
                                {% for group_value, group_name in config.mod.groups %}
                                    <option value="{{ group_value }}"{% if var.value == group_value %} selected{% endif %}>
                                        {{ group_name }}
                                    </option>
                                {% endfor %}
                            </select>
                        {% elseif var.type == 'integer' %}
                            <input name="{{ name }}" type="number" value="{{ var.value|e }}">
                        {% elseif var.type == 'boolean' %}
                            <input name="{{ name }}" type="checkbox" {% if var.value %}checked{% endif %}>
                        {% else %}
                            ?
                        {% endif %}
                        
                        {% if var.type == 'integer' or var.type == 'boolean' %}
                            <small>Default: <code>{{ var.default }}</code></small>
                        {% endif %}
                    </td>
                    
                    <td class="minimal">
                        {{ var.type|e }}
                    </td>
                    
                    <td style="word-wrap:break-word;width:50%">
                        {{ var.comment|join(' ') }}
                    </td>
                </tr>
            {% endif %}
        {% endfor %}
    </table>
    
    <ul style="padding:0;text-align:center;list-style:none">
        <li><input name="save" type="submit" value="{% trans 'Save changes' %}"></li>
    </ul>
</form>

<script>
    const boardInput = document.getElementById('boardInput');
    const suggestions = document.getElementById('boardSuggestions');
    const csrfToken = '{{ token }}';

    let debounceTimeout;
    if (boardInput) {
        boardInput.addEventListener('input', () => {
            clearTimeout(debounceTimeout);
            debounceTimeout = setTimeout(async () => {
                const val = boardInput.value.trim().toLowerCase();
                suggestions.innerHTML = '';
                if (!val) { 
                    suggestions.style.display = 'none'; 
                    return; 
                }

                try {
                    const response = await fetch('?/board_suggestions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: `query=${encodeURIComponent(val)}&token=${encodeURIComponent(csrfToken)}`
                    });
                    if (!response.ok) throw new Error('Network response was not ok');
                    const data = await response.json();

                    if (data.error) {
                        console.error('Error:', data.error);
                        suggestions.style.display = 'none';
                        return;
                    }

                    if (data.boards.length) {
                        suggestions.style.display = 'block';
                        data.boards.forEach(board => {
                            const li = document.createElement('li');
                            li.style.cursor = 'pointer';
                            li.style.padding = '2px 5px';
                            li.innerHTML = `<strong>${board.uri}</strong> (${board.title})`;
                            li.onclick = () => {
                                window.location.href = `?/config/channel/${board.uri}`;
                            };
                            suggestions.appendChild(li);
                        });
                    } else {
                        suggestions.style.display = 'none';
                    }
                } catch (error) {
                    console.error('Error fetching board suggestions:', error);
                    suggestions.style.display = 'none';
                }
            }, 300);
        });

        boardInput.addEventListener('keydown', e => {
            if (e.key === 'Enter') {
                e.preventDefault();
                const val = boardInput.value.trim().toLowerCase();
                if (val) {
                    window.location.href = `?/config/channel/${val}`;
                }
            }
        });
    }
</script>